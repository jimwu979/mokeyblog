"use strict";var global=[];function togglebtn(){$(this).toggleClass("open")}function message_toggle(){var e=$(this);e.hasClass("open")?e.parent().removeClass("off"):e.parent().addClass("off")}function uploadImg(){var t=$(this),e=new FileReader;e.readAsDataURL(t[0].files[0]),e.onload=function(e){t.parent().css("background-image","url(".concat(e.target.result,")"))}}function COMPONENT_getElementHeight(e){return e.height()+parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom"))+parseInt(e.css("border-top-width"))+parseInt(e.css("border-bottom-width"))}function COMPONENT_reset_elementbox_height(){for(var e=$(".COMPONENT_elementbox"),t=e.children(".element"),n=t.length,a=0,l=768<=global.winW?15:7,o=0;o<n;o++)a+=COMPONENT_getElementHeight(t.eq(o))+l;e.height(a)}function COMPONENT_reset_element_position(){for(var e=$(".COMPONENT_elementbox .element"),t=e.length,n=768<=global.winW?15:7,a=n,l=0;l<t;l++){var o=e.eq(l);0<l&&(a+=COMPONENT_getElementHeight(e.eq(l-1))+n),o.css("top",a)}}function COMPONENT_removeElement(){$(this).parents(".element").remove(),COMPONENT_reset_elementbox_height(),COMPONENT_reset_element_position()}function COMPONENT_moveElement(){var e=$(this),t=1<e.index()?1:-1,n=e.parents(".element"),a=e.parents(".COMPONENT_elementbox");a.css("pointer-events","none");var l,o=n.index()+t,i=e.parents(".COMPONENT_elementbox").children(".element").eq(o),r=0<t?n:i,s=0<t?i:n,c=parseInt(r.css("top")),d=COMPONENT_getElementHeight(s),g=s.html(),p=s.attr("data-type");switch(p){case"title":l={"data-id":s.attr("data-id"),htmlTag:"input",value:s.find("input").val()};break;case"paragraphy":l={"data-id":s.attr("data-id"),htmlTag:"textarea",value:s.find("textarea").val()};break;case"image":l={"data-id":s.attr("data-id"),htmlTag:"input",value:s.find("input").val()};break;case"addElement":l={};break;case"member":l={"data-id":s.attr("data-id"),image:{htmlTag:'input[type="file"]',value:s.find('input[type="file"]').val()},name:{htmlTag:'input[placeholder="姓名"]',value:s.find('input[placeholder="姓名"]').val()},job:{htmlTag:'input[placeholder="職位"]',value:s.find('input[placeholder="職位"]').val()}}}s.css("top",c);var m=768<=global.winW?15:7;r.css("top",c+d+m),setTimeout(function(){r.before('<div   class="element" \n                            style="top: '.concat(c,'px"\n                            data-type="').concat(p,'"\n                            data-id="').concat(l["data-id"],'"\n                    >\n                        ').concat(g,"\n                    </div>"));var e=r.prev();switch(e.attr("data-type")){case"title":case"paragraphy":e.find(l.htmlTag).val(l.value);break;case"image":e.find(l.htmlTag).value=l.value;break;case"member":e.find(l.image.htmlTag).value=l.image.value,e.find(l.name.htmlTag).val(l.name.value),e.find(l.job.htmlTag).val(l.job.value)}s.remove(),a.css("pointer-events","")},200)}function COMPONENT_toggleDropdownMenu(){$(this).toggleClass("open")}function COMPONENT_selectElementType(){var e=$(this),t=e.attr("data-type"),n=e.text();e.parent().siblings().attr("data-type",t).text(n)}function COMPONENT_addElement(){var e=$(this),t=e.parent().siblings(".content").children().children("div").attr("data-type"),n="",a=new Date,l="element_"+(n=a.getFullYear().toString()+a.getMonth().toString()+a.getDate().toString()+a.getHours().toString()+a.getMinutes().toString()+a.getSeconds().toString());e.parents(".element").before(global.elementHTML(t,l,global.element_content[t].label,global.element_content[t].content)).prev(".element").find(".COMPONENT_inputbox_image input").attr("id","img_"+n).siblings("label").attr("for","img_"+n),COMPONENT_reset_elementbox_height(),COMPONENT_reset_element_position()}function COMPONENT_selectRadio(){$(this).addClass("check").parent().siblings(".COMPONENT_inputbox_radio").children("label").removeClass("check")}function COMPONENT_inputFocus(){$(this).parent().addClass("focus")}function COMPONENT_inputBlur(){$(this).parent().removeClass("focus")}function init(){global.winW=global.win.width(),global.winH=global.win.height();for(var e,t,n,a=$(".COMPONENT_elementbox"),l=a.children().length,o=0;o<l;o++){var i=a.children().eq(o);switch(i.prop("tagName").toLowerCase()){case"h3":e="title",t=i.text(),n=i.attr("data-id"),i.before(global.elementHTML(e,n,global.element_content[e].label,global.element_content[e].content)).prev().find("input").val(t).parents(".element").next().remove();break;case"p":e="paragraphy",t=i.text(),n=i.attr("data-id"),i.before(global.elementHTML(e,n,global.element_content[e].label,global.element_content[e].content)).prev().find("textarea").val(t).parents(".element").next().remove();break;case"img":e="image",n=i.attr("data-id"),t=i.attr("src");var r=new Date,s="upload_img"+r.getFullYear().toString()+r.getMonth().toString()+r.getDate().toString()+r.getHours().toString()+r.getMinutes().toString()+r.getSeconds().toString();i.before(global.elementHTML(e,n,global.element_content[e].label,global.element_content[e].content)).prev().find(".COMPONENT_inputbox_image").attr("style","background-image: url("+t+")").children("input").attr("id",s).siblings("label").attr("for",s).parents(".element").next().remove()}}COMPONENT_reset_elementbox_height(),COMPONENT_reset_element_position()}function ajax(e){e||console.log("請於 ajax() 中填入欲傳遞的資料");var t={url:window.location.pathname,content:e};$.ajax({type:"POST",url:"function/ajax_receiver.php",dataType:"text",data:t,success:function(e){console.log(e)},error:function(e){console.log("ERROR!"),console.log("data.status :"+e.status)}})}function toggleMenu(){$(this).parent().toggleClass("open")}global.window=$(window),global.win=$("#fixbox"),global.winW=global.win.width(),global.winH=global.win.height(),global.elementHTML=function(e,t,n,a){return'<div class="element" data-type="'.concat(e,'" data-id="').concat(t,'">\n                <label>').concat(n,'</label>\n                <div class="content">').concat(a,'</div>\n                <div class="btn_box">\n                    <div class="delete"></div>\n                    <div class="up"></div>\n                    <div class="down"></div>\n                </div>\n            </div>')},global.element_content={title:{label:"標題",content:'<div class="COMPONENT_inputbox_text">\n                        <input type="text">\n                    </div>'},paragraphy:{label:"段落",content:'<textarea class="COMPONENT_inputbox_textarea"></textarea>'},image:{label:"圖片",content:'<div class="COMPONENT_inputbox_image">\n                        <input type="file" id="img_">\n                        <label for="upload_img"></label>\n                    </div>'},member:{label:"成員",content:'<div class="member">\n                        <div class="img">\n                            <div class="COMPONENT_inputbox_image">\n                                <input type="file" id="" accept="image/jpeg, image/png">\n                                <label for=""></label>\n                            </div>\n                        </div>\n                        <div class="text">\n                            <div class="COMPONENT_inputbox_text">\n                                <input type="text" placeholder="姓名">\n                            </div>\n                            <div class="COMPONENT_inputbox_text">\n                                <input type="text" placeholder="職位">\n                            </div>\n                        </div>\n                    </div>'}},$(".COMPONENT_elementbox").on("click",".btn_box .delete",COMPONENT_removeElement).on("click",".btn_box .up, .btn_box .down",COMPONENT_moveElement).on("click",".COMPONENT_inputbox_dropdown",COMPONENT_toggleDropdownMenu).on("click",".COMPONENT_inputbox_dropdown li",COMPONENT_selectElementType).on("click",".element .add",COMPONENT_addElement),$(".COMPONENT_inputbox_text input").on({focus:COMPONENT_inputFocus,blur:COMPONENT_inputBlur}),$(".body").on("change",".COMPONENT_inputbox_image input",uploadImg),$(".COMPONENT_inputbox_radio label").click(COMPONENT_selectRadio),$(".COMPONENT_togglebtn").click(togglebtn),$(".COMPONENT_message .COMPONENT_togglebtn").click(message_toggle),init(),$(window).resize(init),$("header .menu_btn").click(toggleMenu),$("html head").prepend("<style>.t{box-shadow: 0 0 3px #F22 inset;animation: test .2s 0s infinite alternate-reverse forwards;}@keyframes test{to{box-shadow: 0 0 2px #22F inset;}}</style>"),localStorage.scrollTop&&$(".body").scrollTop(localStorage.scrollTop),$(".body").on("scroll",function(){localStorage.setItem("scrollTop",$(".body").scrollTop())});